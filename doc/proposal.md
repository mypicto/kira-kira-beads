# 「きらきら・ビーズ・コピー」Web プロトタイプ 企画書

## 1. 概要

* タイトル：きらきら・ビーズ・コピー Web プロトタイプ
* バージョン：v0.1
* プラットフォーム：Mac + Google Chrome
* ゲーム構成：3 ラウンド制（3 ラウンド合計ポイントを最後に発表）
* 技術スタック：React 18 + TypeScript 5系 + Vite（想定）

---

## 2. 目的（変更なし、抜粋）

* コアゲームループの検証
  「提示 → 消える → 再現 → 採点 → 復習」の流れが自然に体験できるか。
* 視覚イメージ記憶を誘導する UI/UX の検証。
* 今回追加：

  * 誤答時の「復習画面」が、どこを間違えたか理解するのに役立つか。
  * 0〜100 点のスコアリングが「近さ」の感覚として納得感があるか。

---

## 3. 基本コンセプト（抜粋）

> 一瞬表示されるビーズの並びを、
> 頭の中のイメージを頼りにコピーする記憶ゲーム。
>
> 正解と自分の回答を見比べることで、
> 「どこが違っていたか」を視覚的に理解できる。

---

## 4. 画面構成

### 4.1 主要エリア

1. 上段：**問題エリア**（スロット列）
2. 中段：**結果・復習エリア**（フェーズにより内容が変化）

   * 通常プレイ中は「状態アイコン」（目／手など）
   * 結果フェーズでは「正解 vs ユーザー回答」の比較ビュー
3. 下段：**ビーズストックエリア**
4. 右上：**決定ボタン（OK）**
5. 左上：**リセットボタン**
6. 右下：**難易度切替ボタン**
7. 結果フェーズ時：**「つぎへ」ボタン**（復習完了の明示）

---

## 5. ゲームフロー

### 5.1 フェーズ定義

```ts
type GamePhase = 'idle' | 'showing' | 'reproduce' | 'result';
```

* `idle`：待機（次の問題を開始していない状態）
* `showing`：正解パターンを一括表示
* `reproduce`：ユーザーが再現操作
* `result`：採点結果と比較ビューを表示（ユーザー操作でのみ終了）

### 5.2 フェーズ遷移（更新）

| 現フェーズ     | トリガー              | 次フェーズ     |
| --------- | ----------------- | --------- |
| idle      | 再生ボタン押下 or 初回自動開始 | showing   |
| showing   | 提示タイマー終了          | reproduce |
| reproduce | 決定ボタン押下           | result    |
| result    | 「つぎへ」ボタン押下        | idle      |

必ずユーザーが「つぎへ」ボタンを押すまで結果画面のまま待機する。

### 5.3 ラウンド構成（3 ラウンド制）

* 1 ゲームセッション = 3 ラウンド（3 問連続）。
* `currentRound`（1〜3）とラウンド別スコアを管理し、`result` フェーズ完了のたびにインクリメント。
* Round 1, 2 の「つぎへ」押下 → 次ラウンドの `showing` を開始（`idle` 経由でも可）。
* Round 3 の「つぎへ」押下 → 3 ラウンド合計ポイントの発表ビューへ遷移。
* 発表完了後にリセット（Round を 1、合計スコアを 0 に戻す）し、ゲーム開始待ち状態へ戻る。

---

## 6. 結果表示・復習仕様（新規）

### 6.1 比較ビューの構成

結果フェーズ `result` では、中段エリアに以下を並べて表示する。

* 左：**正解パターン**

  * ラベル：アイコン等（例：王冠マーク＋「お手本」的な絵）
  * 5 マスのスロットに、正解のビーズ配置をそのまま表示

* 右：**ユーザー回答**

  * ラベル：アイコン等（例：人型アイコン）
  * 5 マスのスロットに、ユーザーが配置したビーズを表示

スロットは左右で縦方向に揃え、1列ごとに「正解 vs 自分」が一目で分かるようにする。

### 6.2 間違い部位の強調表示

* 各インデックス i（0〜4）について:

  * 正解スロットとユーザースロットの差異に応じて枠を色分け：

    * 完全一致（位置＋ビーズ属性が同一）
      → 枠を薄い緑色でハイライト
    * 位置は合っているが属性の一部が不一致
      → 枠を黄色でハイライト
    * ビーズ有無が異なる、または完全に違う
      → 枠を赤色でハイライト

* マウスオーバー（任意・余力があれば）で詳細ツールチップ：

  * 例：「いろがちがう」「かたちがちがう」などをアイコンで表現

### 6.3 スコア表示

* 比較ビューと一緒にスコアを表示する。

表示要素：

* **総合スコア：0〜100点**（中央の大きな数値）
* ミニメーター（バーや円グラフ）で視覚的に表現
* 任意で、サブ評価指標（後述の各要素）をアイコン付きバーで表示

### 6.4 「つぎへ」ボタン

* 結果フェーズでは、画面下部中央に「▷ つぎへ」風のアイコンボタンを表示
* 押すまではフェーズを `result` のまま固定し、

  * 新しい問題を生成しない
  * ストックやスロットの操作を不可にする（復習に集中）

### 6.5 3 ラウンド合計ポイント表示

* Round 3 終了後、専用の結果ビューで「3 ラウンド合計ポイント」を発表する。
* 表示内容：

  * **3 ラウンド合計ポイント（最大 300 点）** — 画面中央で大きく、色面やエフェクトを使って目立たせる。
  * 任意でラウンド別の獲得点（Round1〜3）を並べて表示し、合計までの流れを理解しやすくする。
* ユーザーが確認してボタンを押すと、ラウンドカウンタとスコアを初期化し、ゲーム開始待ち（Round1）へ戻る。

---

## 7. 採点仕様（0〜100 点スコアリング）

### 7.1 基本方針

* 単純な「正解／不正解」ではなく、
  「どれだけ正解に近いか」を連続値（0〜100 点）で評価する。
* 評価要素は以下：

  1. ビーズの位置の一致度（どれだけ離れたマスに置いてしまったか）
  2. 色の一致
  3. 形の一致
  4. サイズの一致
* 各要素を 0〜1 のスコアにし、線形に合成して 0〜100 にスケーリングする。

### 7.2 前提

* `numSlots` = 5 固定
* 正解のうち、実際にビーズが配置されているスロット数 = `numBeadsInProblem`
* 空スロットも評価対象（正解が空なのに置いてしまった場合など）

### 7.3 評価モデル（提案）

スコアは「**位置スコア**」「**属性スコア**」の2成分に分解する。

1. 位置スコア（0〜1）
2. 属性スコア（0〜1）

   * 色・形・サイズの一致度

総合スコア `totalScore`:

[
\text{totalScore} = 100 \times \left( w_{\text{pos}} \cdot S_{\text{pos}} + w_{\text{attr}} \cdot S_{\text{attr}} \right)
]

* (w_{\text{pos}} = 0.5)（位置 50%）
* (w_{\text{attr}} = 0.5)（属性 50%）
* (S_{\text{pos}}, S_{\text{attr}} \in [0,1])

#### 7.3.1 位置スコア (S_{\text{pos}})

* 正解の各ビーズに対して、「どのスロットに置かれていたか」を測る。
* スロットインデックスを 0〜4 とし、最大距離は 4。

アルゴリズム（簡略）：

1. 正解の各スロット i について:

   * 正解スロット i にビーズあり

     * ユーザー側で、**同じ属性のビーズ**がどのスロット j にあるかを探索（最適マッチングは省略し、単純な位置比較でよい）
     * 見つかった場合：距離 (d = |i - j|)

       * 位置スコア候補：
         [
         s_i^{pos} = 1 - \frac{d}{4}
         ]
         （同じマスなら 1、最大離れていると 0）
     * 見つからない場合（まったく別のビーズ or 何も置かれていない）：

       * (s_i^{pos} = 0)
   * 正解スロット i が空の場合：

     * ユーザー側も空 → (s_i^{pos} = 1)
     * ユーザー側に何か置いている → (s_i^{pos} = 0)

2. 全スロットで平均：
   [
   S_{\text{pos}} = \frac{1}{\text{numSlots}} \sum_{i=0}^{\text{numSlots}-1} s_i^{pos}
   ]

※ 簡易版として、「正解ビーズの位置と同じインデックスにあるか」を見るだけでもよい（d=0 or 4 など）。

#### 7.3.2 属性スコア (S_{\text{attr}})

位置がどうであれ、「そのスロットに置かれたビーズの属性がどれだけ正解に近いか」を測る。

* 各スロット i に対して：

  * 正解もユーザーもビーズあり：

    * 色一致：(c_i = 1) / 不一致：0
    * 形一致：(sh_i = 1) / 不一致：0
    * サイズ一致：(sz_i = 1) / 不一致：0

    属性スコア：
    [
    s_i^{attr} = \frac{c_i + sh_i + sz_i}{3}
    ]

  * 片方のみビーズあり：

    * (s_i^{attr} = 0)

  * 両方空：

    * 「何も置かなかった」という意味で完全一致とみなし、
      (s_i^{attr} = 1)

* 全スロットで平均：
  [
  S_{\text{attr}} = \frac{1}{\text{numSlots}} \sum_{i=0}^{\text{numSlots}-1} s_i^{attr}
  ]

#### 7.3.3 スコアの丸め

* `totalScore` は 0〜100 の実数値になるため、小数点以下を四捨五入して整数表示。
* 内部的には小数を保持してもよいが、UI 上は整数のみ表示。

### 7.4 補助的なランク表示（任意）

ユーザー向けに分かりやすくするため、スコアからランクも導出できる。

例：

* 90〜100：PERFECT（3★）
* 70〜89：GOOD（2★）
* 40〜69：OK（1★）
* 0〜39：TRY AGAIN（★なし）

ランクはあくまで付加情報であり、内部評価は 0〜100 点が主。
